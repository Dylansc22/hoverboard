!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);var c=b;c=c.L||(c.L={}),c=c.tileLayer||(c.tileLayer={}),c.hoverboard=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./renderingInterface");b.exports=function(a,b){b=b||{},b.async=!0;var d=L.tileLayer.canvas(b);d.setUrl(a);var e={};e.WGS84=function(a){return a=a||{x:0,y:0},d3.geo.transform({point:function(a,b){var c=d._map.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x-tileOffset.x,c.y-tileOffset.y)}})};var f={};f.geojson={extensions:["geojson","json"],get:function(a,b){var c=d3.json(a,b);return c.abort.bind(c)},parse:function(a,b){var c={x:parseInt(d3.select(b).style("left").slice(0,-2)),y:parseInt(d3.select(b).style("top").slice(0,-2))};return{data:{layer:a},projection:e.WGS84(c)}}},f.topojson={extensions:["topojson"],get:function(a,b){var c=d3.json(a,b);return c.abort.bind(c)},parse:function(a,b){var c={x:parseInt(d3.select(b).style("left").slice(0,-2)),y:parseInt(d3.select(b).style("top").slice(0,-2))},d={};for(var f in a.objects)d[f]=topojson.feature(a,a.objects[f]);return{data:d,projection:e.WGS84(c)}}},f.protobuf={extensions:["mvt","pbf"],get:function(a,b){var c=d3.xhr(a).responseType("arraybuffer").get(b);return c.abort.bind(c)},parse:function(a,c){var e=new VectorTile(new pbf(new Uint8Array(a))),f={};for(var g in e.layers)f[g]=e.layers[g].toGeoJSON();return{data:f,projection:d3.geo.transform({point:function(a,f){a=a/e.layers[d.__currentLayer].extent*c.width,f=f/e.layers[d.__currentLayer].extent*c.height,b.hidpiPolyfill&&(a*=1/window.devicePixelRatio,f*=1/window.devicePixelRatio),this.stream.point(a,f)}})}}};var g="auto";d.mode=function(a){return g=a,d};var h=[];return d.render=function(a,b){if("function"==typeof b)return h.push({layer:a,run:b}),d;var e=new c(d,a);return h.push({layer:a,run:e.run.bind(e)}),e},d.drawTile=function(a,c,e){var i=a.getContext("2d");c={x:c.x,y:c.y,z:e};var j;if("auto"==g){var k=d._url.split("?")[0].split(".").pop();for(var l in f)if(-1!=f[l].extensions.indexOf(k)){j=f[l];break}if(!j)throw new Error("I don't know what to do with URLs ending in ."+k)}else j="object"==typeof g?g:f[g];var m=d.getTileUrl(c);j.get(m,function(e,f){if(e)throw e;var g=j.parse(f.response,c),k=d3.geo.path().projection(g.projection).context(i),l=a.width,m=a.height;if(b.hidpiPolyfill&&(l*=1/window.devicePixelRatio,l*=1/window.devicePixelRatio),i.clearRect(0,0,l,m),!h.length)throw new Error("No renderer specified!");h.forEach(function(a){g.data[a.layer]&&(d.__currentLayer=a.layer,a.run(i,g.data[a.layer].features,c,function(a){"object"!=typeof a||Array.isArray(a)||(a=[a]),i.beginPath(),a.forEach(k)}))}),d.tileDrawn(a)})},d}},{"./renderingInterface":2}],2:[function(a,b){var c=function(a,b){this.layer=a,this.layerName=b,this.instructions=[],this.whereConditions=[];var c=this;Object.keys(a.__proto__).forEach(function(b){c[b]=function(){return a[b].apply(a,arguments)}}),["render","data","mode","addTo"].forEach(function(b){c[b]=function(){return a[b].apply(a,arguments)}})};c.prototype.minZoom=function(a){return this.minZoom=a,this},c.prototype.maxZoom=function(a){return this.maxZoom=a,this},c.prototype.fill=function(a){return this.instructions.push({type:"fill",color:a}),this},c.prototype.stroke=function(a,b){return this.instructions.push({type:"stroke",width:a,color:b}),this},c.prototype.fillBy=function(a,b,c){return this.fill(function(d){return b[d.properties[a]]||c}),this},c.prototype.strokeBy=function(a,b,c){return this.stroke(function(d){return b[d.properties[a]]||c}),this},c.prototype._where=function(a){console.log("where",a);var b=a.field,c=a.value;if("undefined"==typeof c)if("string"==typeof b)this.where(function(a){return a.properties[b]?!0:!1},void 0,a.invert);else if("object"==typeof b)for(var d in b)this.where(d,b[d],a.invert);else{if("function"!=typeof b)throw new Error("with RenderingInterface.where(field, value) if value is undefined then field must be a string, object, or function!");if(a.invert){var e=b;console.log("inverting"),b=function(){return!e.apply(null,arguments)}}this.whereConditions.push(b)}else if("string"==typeof c||"number"==typeof c)this.where(function(a){return a.properties[b]==c},void 0,a.invert);else{if("object"!=typeof c||!Array.isArray(c))throw new Error("RenderingInterface.where(field, value) cannot be called with field as type "+typeof b+" and value as type "+typeof c);this.where(function(a){return-1!=c.indexOf(a.properties[b])},void 0,a.invert)}return this},c.prototype.where=function(a,b,c){return this._where({field:a,value:b,invert:c})},c.prototype.whereNot=function(a,b){return console.log("whereNot",a,b),this._where({field:a,value:b,invert:!0})},c.prototype.run=function(a,b,c,d){"number"==typeof this.minZoom&&c.z<this.minZoom||"number"==typeof this.maxZoom&&c.z>this.maxZoom||(this.whereConditions.forEach(function(a){b=b.filter(a)}),this.instructions.forEach(function(c){if("fill"==c.type)if("string"==typeof c.color)a.fillStyle=c.color,d(b),a.fill();else{if("function"!=typeof c.color)throw new Error("fill color must be string or function, is type "+typeof c.color);b.forEach(function(b){a.fillStyle=c.color(b),d(b),a.fill()})}else if("stroke"==c.type)if("number"==typeof c.width&&"string"==typeof c.color)a.lineWidth=c.width,a.strokeStyle=c.color,d(b),a.stroke();else{if("function"!=typeof c.width&&"function"!=typeof c.color)throw new Error("Expected stroke(number or function, string or function) or stroke(function), got stroke("+typeof c.width+", "+typeof c.color+")");b.forEach(function(b){var e="function"==typeof c.width?c.width(b):c.width,f="function"==typeof c.color?c.color(b):c.color;"undefined"==typeof c.color&&Array.isArray(e)&&(f=e[1],e=e[0]),d(b),a.stroke()})}}))},b.exports=c},{}]},{},[1])(1)});